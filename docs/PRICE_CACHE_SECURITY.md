# èµ„è´¹ç¼“å­˜ä¸ä»·æ ¼é˜²ç¯¡æ”¹æœºåˆ¶

## ğŸ“‹ æ–‡æ¡£ç›®çš„

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜ elife-service é¡¹ç›®ä¸­èµ„è´¹ç¼“å­˜çš„è®¾è®¡æ€è·¯,ä»¥åŠå¦‚ä½•é€šè¿‡ç¼“å­˜æœºåˆ¶é˜²æ­¢å‰ç«¯ç¯¡æ”¹ä»·æ ¼ã€‚

---

## ğŸ¯ æ ¸å¿ƒé—®é¢˜

### é—®é¢˜1: ä¸ºä»€ä¹ˆéœ€è¦ç¼“å­˜?
1. **å‡å°‘ç¬¬ä¸‰æ–¹ API è°ƒç”¨** - Unitel API å¯èƒ½æœ‰é™æµæˆ–æ”¶è´¹
2. **æå‡å“åº”é€Ÿåº¦** - èµ„è´¹æ•°æ®ç›¸å¯¹ç¨³å®š,æ— éœ€æ¯æ¬¡å®æ—¶æŸ¥è¯¢
3. **é˜²æ­¢ä»·æ ¼ç¯¡æ”¹** - åç«¯ç¼“å­˜ä½œä¸ºä»·æ ¼éªŒè¯çš„å¯ä¿¡æº

### é—®é¢˜2: ä¸ºä»€ä¹ˆä¸ç›´æ¥ç›¸ä¿¡å‰ç«¯ä¼ æ¥çš„ä»·æ ¼?
å‰ç«¯ä¼ æ¥çš„ä»»ä½•æ•°æ®éƒ½å¯èƒ½è¢«ç¯¡æ”¹(ä¾‹å¦‚é€šè¿‡æµè§ˆå™¨å¼€å‘è€…å·¥å…·ä¿®æ”¹è¯·æ±‚)ã€‚å¦‚æœç›´æ¥ä½¿ç”¨å‰ç«¯ä»·æ ¼:
- âŒ ç”¨æˆ·å¯èƒ½å°† 5000 MNT çš„å¥—é¤æ”¹æˆ 1 MNT
- âŒ å¾®ä¿¡æ”¯ä»˜é‡‘é¢ä¸å®é™…å¥—é¤ä»·æ ¼ä¸ç¬¦
- âŒ é€ æˆèµ„é‡‘æŸå¤±

---

## ğŸ”’ é˜²ç¯¡æ”¹æœºåˆ¶è®¾è®¡

### æ ¸å¿ƒæ€è·¯: åç«¯éªŒè¯ä»·æ ¼

```
å‰ç«¯è·å–èµ„è´¹åˆ—è¡¨
    â†“
åç«¯è°ƒç”¨ç¬¬ä¸‰æ–¹ API + ç¼“å­˜åˆ° Redis (5åˆ†é’Ÿ)
    â†“
å‰ç«¯å±•ç¤ºèµ„è´¹ç»™ç”¨æˆ·
    â†“
ç”¨æˆ·é€‰æ‹©å¥—é¤,æäº¤è®¢å•(åªä¼  packageCode)
    â†“
åç«¯ä»ç¼“å­˜ä¸­æŸ¥æ‰¾ packageCode å¯¹åº”çš„çœŸå®ä»·æ ¼
    â†“
åˆ›å»ºè®¢å•æ—¶ä½¿ç”¨åç«¯æŸ¥æ‰¾åˆ°çš„ä»·æ ¼(ä¸ä½¿ç”¨å‰ç«¯ä¼ æ¥çš„ä»·æ ¼)
```

**å…³é”®ç‚¹:** å‰ç«¯åªä¼  `packageCode`,ä»·æ ¼ç”±åç«¯ä»ç¼“å­˜æŸ¥æ‰¾,ç¡®ä¿ä»·æ ¼ä¸è¢«ç¯¡æ”¹ã€‚

---

## ğŸ“ æŠ€æœ¯å®ç°

### 1. ç¼“å­˜é”®è®¾è®¡

```typescript
// Redis ç¼“å­˜é”®æ ¼å¼
const cacheKey = `unitel:service_types:{openid}:{msisdn}`;

// ç¤ºä¾‹
"unitel:service_types:oABC123:99887766"
```

**ä¸ºä»€ä¹ˆåŒ…å« openid?**
- ä¸åŒç”¨æˆ·çš„èµ„è´¹å¯èƒ½ä¸åŒ(ä¾‹å¦‚ VIP ç”¨æˆ·ã€åœ°åŒºå·®å¼‚)
- éš”ç¦»ä¸åŒç”¨æˆ·çš„ç¼“å­˜,é¿å…æ··æ·†

**ä¸ºä»€ä¹ˆåŒ…å« msisdn?**
- ä¸åŒæ‰‹æœºå·çš„èµ„è´¹å¯èƒ½ä¸åŒ(é¢„ä»˜è´¹ vs åä»˜è´¹)

### 2. ç¼“å­˜æ—¶æœº

#### åœºæ™¯1: å‰ç«¯è·å–èµ„è´¹åˆ—è¡¨

```typescript
// unitel-service.controller.ts
@Post('service-types')
async getServiceTypes(
  @CurrentUser('openid') openid: string, // â¬…ï¸ ä» JWT è‡ªåŠ¨æå–
  @Body() dto: GetServiceTypeDto,        // { msisdn: "99887766" }
) {
  // è°ƒç”¨å¸¦ç¼“å­˜çš„æ–¹æ³•
  return this.unitelApiService.getCachedServiceTypes(dto.msisdn, openid);
}
```

**æ‰§è¡Œæµç¨‹:**
1. æ£€æŸ¥ Redis é”®: `unitel:service_types:{openid}:{msisdn}`
2. å¦‚æœå­˜åœ¨ â†’ ç›´æ¥è¿”å›ç¼“å­˜(âš¡ å¿«é€Ÿ)
3. å¦‚æœä¸å­˜åœ¨ â†’ è°ƒç”¨ Unitel API,ç¼“å­˜ 5 åˆ†é’Ÿ

#### åœºæ™¯2: åˆ›å»ºè®¢å•æ—¶éªŒè¯ä»·æ ¼

```typescript
// unitel-order.service.ts
async createOrder(openid: string, dto: CreateOrderDto) {
  // 1. æ ¹æ® packageCode æŸ¥æ‰¾å¥—é¤è¯¦æƒ…(ä»ç¼“å­˜æˆ– API)
  const packageDetail = await this.unitelApiService.findPackageByCode({
    packageCode: dto.packageCode,  // å‰ç«¯åªä¼  code,ä¸ä¼  price
    msisdn: dto.msisdn,
    openid,
    orderType: dto.orderType,
  });

  // 2. ä½¿ç”¨åç«¯æŸ¥æ‰¾åˆ°çš„ä»·æ ¼åˆ›å»ºè®¢å•
  const order = await this.prisma.unitelOrder.create({
    data: {
      // ...
      amountMnt: packageDetail.price, // â¬…ï¸ ä½¿ç”¨åç«¯éªŒè¯çš„ä»·æ ¼
      packageCode: packageDetail.code,
      packageName: packageDetail.name,
      // ...
    },
  });
}
```

**æ‰§è¡Œæµç¨‹:**
1. è°ƒç”¨ `findPackageByCode` æŸ¥æ‰¾å¥—é¤
2. å†…éƒ¨è°ƒç”¨ `getCachedServiceTypes(msisdn, openid)` (ç›¸åŒç¼“å­˜é”®!)
3. ä»èµ„è´¹åˆ—è¡¨ä¸­æŸ¥æ‰¾ `packageCode` å¯¹åº”çš„å¥—é¤
4. è¿”å›çœŸå®ä»·æ ¼ `packageDetail.price`
5. åˆ›å»ºè®¢å•æ—¶ä½¿ç”¨è¿™ä¸ªä»·æ ¼

### 3. ç¼“å­˜é”®ä¸€è‡´æ€§éªŒè¯

**å…³é”®ç‚¹:** ä¸¤ä¸ªåœºæ™¯ä½¿ç”¨**ç›¸åŒçš„ç¼“å­˜é”®**

| åœºæ™¯ | è°ƒç”¨è·¯å¾„ | ç¼“å­˜é”® |
|------|---------|--------|
| è·å–èµ„è´¹ | Controller â†’ `getCachedServiceTypes(msisdn, openid)` | `unitel:service_types:{openid}:{msisdn}` |
| åˆ›å»ºè®¢å• | Service â†’ `findPackageByCode` â†’ `getCachedServiceTypes(msisdn, openid)` | `unitel:service_types:{openid}:{msisdn}` |

âœ… **ç¼“å­˜é”®ç›¸åŒ â†’ ç¡®ä¿ä»·æ ¼æ¥è‡ªåŒä¸€ä»½æ•°æ®æº â†’ é˜²æ­¢ç¯¡æ”¹**

---

## ğŸ”„ å®Œæ•´æµç¨‹ç¤ºä¾‹

### ç”¨æˆ·æ“ä½œæµç¨‹

```
æ­¥éª¤1: ç”¨æˆ·è¾“å…¥æ‰‹æœºå· 99887766,ç‚¹å‡»"è·å–èµ„è´¹"
    â†“
å‰ç«¯: POST /api/operators/unitel/service-types
Body: { "msisdn": "99887766" }
Header: Authorization: Bearer {jwt_token}
    â†“
åç«¯: unitel-service.controller.ts
  - ä» JWT æå– openid = "oABC123"
  - è°ƒç”¨ getCachedServiceTypes("99887766", "oABC123")
  - Redis é”®: "unitel:service_types:oABC123:99887766"
  - é¦–æ¬¡è¯·æ±‚ â†’ è°ƒç”¨ Unitel API â†’ ç¼“å­˜ 5 åˆ†é’Ÿ
  - è¿”å›èµ„è´¹åˆ—è¡¨:
    {
      service: {
        cards: {
          day: [
            { code: "SD5000", name: "5000â‚®", price: 5000, ... },
            { code: "SD10000", name: "10000â‚®", price: 10000, ... }
          ]
        }
      }
    }
    â†“
å‰ç«¯: å±•ç¤ºèµ„è´¹åˆ—è¡¨(è‡ªåŠ¨æ¢ç®—ä¸ºäººæ°‘å¸)
  - SD5000: Â¥11.36 (5000 / 440)
  - SD10000: Â¥22.73 (10000 / 440)
    â†“
æ­¥éª¤2: ç”¨æˆ·é€‰æ‹© SD5000,ç‚¹å‡»"åˆ›å»ºè®¢å•"
    â†“
å‰ç«¯: POST /api/operators/unitel/orders
Body: {
  "msisdn": "99887766",
  "orderType": "balance",
  "packageCode": "SD5000"  // â¬…ï¸ åªä¼  code,ä¸ä¼  price
}
    â†“
åç«¯: unitel-order.controller.ts â†’ unitel-order.service.ts
  - createOrder(openid="oABC123", dto)
  - è°ƒç”¨ findPackageByCode({
      packageCode: "SD5000",
      msisdn: "99887766",
      openid: "oABC123",
      orderType: "balance"
    })
  - å†…éƒ¨è°ƒç”¨ getCachedServiceTypes("99887766", "oABC123")
  - ä½¿ç”¨ç›¸åŒ Redis é”®: "unitel:service_types:oABC123:99887766"
  - å‘½ä¸­ç¼“å­˜! ç›´æ¥ä» Redis è¿”å›èµ„è´¹åˆ—è¡¨
  - åœ¨åˆ—è¡¨ä¸­æŸ¥æ‰¾ code="SD5000" çš„å¥—é¤
  - æ‰¾åˆ°: { code: "SD5000", price: 5000, ... }
  - éªŒè¯é€šè¿‡! ä½¿ç”¨ price=5000 åˆ›å»ºè®¢å•
    â†“
åç«¯: è¿”å›è®¢å•ä¿¡æ¯
{
  "orderNo": "UNI1729700000ABC12345",
  "packageCode": "SD5000",
  "amountMnt": 5000,  // â¬…ï¸ åç«¯éªŒè¯çš„ä»·æ ¼
  "amountCny": 11.36,
  "paymentStatus": "unpaid",
  ...
}
```

### ğŸš¨ æ”»å‡»åœºæ™¯åˆ†æ

**åœºæ™¯: æ¶æ„ç”¨æˆ·å°è¯•ç¯¡æ”¹ä»·æ ¼**

```
æ­¥éª¤1: é»‘å®¢è·å–èµ„è´¹åˆ—è¡¨(æ­£å¸¸æµç¨‹)
    â†“
æ­¥éª¤2: é»‘å®¢ä¿®æ”¹è¯·æ±‚,å°è¯•ä¼ å…¥ä½ä»·
å‰ç«¯(ä¿®æ”¹å): POST /api/operators/unitel/orders
Body: {
  "msisdn": "99887766",
  "orderType": "balance",
  "packageCode": "SD5000",
  "amountMnt": 1,           // â¬…ï¸ ç¯¡æ”¹ä»·æ ¼(æ— æ•ˆ!)
  "amountCny": 0.01          // â¬…ï¸ ç¯¡æ”¹ä»·æ ¼(æ— æ•ˆ!)
}
    â†“
åç«¯: unitel-order.service.ts
  - CreateOrderDto ä¸­æ ¹æœ¬æ²¡æœ‰ amountMnt/amountCny å­—æ®µ âœ…
  - åç«¯ä»ç¼“å­˜æŸ¥æ‰¾ SD5000 çš„çœŸå®ä»·æ ¼ = 5000
  - åˆ›å»ºè®¢å•æ—¶ä½¿ç”¨ price=5000(å¿½ç•¥å‰ç«¯ä¼ æ¥çš„ä»·æ ¼)
    â†“
ç»“æœ: æ”»å‡»å¤±è´¥! è®¢å•ä»·æ ¼ä¸º 5000 MNT
```

**å…³é”®é˜²å¾¡æªæ–½:**
1. DTO ä¸æ¥æ”¶ä»·æ ¼å­—æ®µ - `CreateOrderDto` åªæœ‰ `msisdn, orderType, packageCode`
2. ä»·æ ¼ç”±åç«¯æŸ¥æ‰¾ - ä»å¯ä¿¡ç¼“å­˜æºè·å–
3. ç¼“å­˜éªŒè¯ - ç¡®ä¿ä»·æ ¼æ¥è‡ª 5 åˆ†é’Ÿå†…çš„ç¬¬ä¸‰æ–¹ API æ•°æ®

---

## â±ï¸ ç¼“å­˜ TTL è®¾è®¡

### ä¸ºä»€ä¹ˆæ˜¯ 5 åˆ†é’Ÿ?

```typescript
private readonly CACHE_TTL = 300; // 5åˆ†é’Ÿ(ç§’)
```

**è€ƒè™‘å› ç´ :**
- âœ… **èµ„è´¹å˜åŠ¨é¢‘ç‡ä½** - è¿è¥å•†èµ„è´¹é€šå¸¸æŒ‰å¤©/å‘¨è°ƒæ•´,ä¸æ˜¯å®æ—¶å˜åŒ–
- âœ… **ç”¨æˆ·å†³ç­–æ—¶é—´** - ç”¨æˆ·ä»æŸ¥çœ‹èµ„è´¹åˆ°åˆ›å»ºè®¢å•é€šå¸¸åœ¨å‡ åˆ†é’Ÿå†…
- âœ… **å‡å°‘ API è°ƒç”¨** - 5 åˆ†é’Ÿå†…å¤šæ¬¡è¯·æ±‚åªè°ƒç”¨ä¸€æ¬¡ç¬¬ä¸‰æ–¹ API
- âš ï¸ **ä»·æ ¼æ—¶æ•ˆæ€§** - å¦‚æœè¶…è¿‡ 5 åˆ†é’Ÿ,ä¼šé‡æ–°è·å–æœ€æ–°ä»·æ ¼

**æç«¯æƒ…å†µå¤„ç†:**
- å¦‚æœç”¨æˆ·åœ¨ç¬¬ 4 åˆ† 59 ç§’è·å–èµ„è´¹,åœ¨ç¬¬ 5 åˆ† 01 ç§’åˆ›å»ºè®¢å•
- ç¼“å­˜è¿‡æœŸ â†’ åˆ›å»ºè®¢å•æ—¶ä¼šé‡æ–°è°ƒç”¨ API è·å–æœ€æ–°ä»·æ ¼
- **è¿™æ˜¯å¯æ¥å—çš„è¡Œä¸º** - ç¡®ä¿ä»·æ ¼å‡†ç¡®æ€§ä¼˜å…ˆ

---

## ğŸ” éªŒè¯æ–¹æ³•

### æµ‹è¯•ç¼“å­˜æ˜¯å¦ç”Ÿæ•ˆ

#### æµ‹è¯•1: éªŒè¯ç¼“å­˜é”®

```bash
# 1. å‰ç«¯è·å–èµ„è´¹
curl -X POST http://localhost:3000/api/operators/unitel/service-types \
  -H "Authorization: Bearer {token}" \
  -H "Content-Type: application/json" \
  -d '{"msisdn": "99887766"}'

# 2. æ£€æŸ¥ Redis ç¼“å­˜
redis-cli
> KEYS unitel:service_types:*
"unitel:service_types:oABC123:99887766"  # âœ… ç¼“å­˜å·²åˆ›å»º

> TTL unitel:service_types:oABC123:99887766
(integer) 298  # âœ… TTL çº¦ä¸º 300 ç§’(5åˆ†é’Ÿ)

> GET unitel:service_types:oABC123:99887766
"{\"service\":{...}}"  # âœ… å®Œæ•´çš„èµ„è´¹æ•°æ®
```

#### æµ‹è¯•2: éªŒè¯åˆ›å»ºè®¢å•ä½¿ç”¨ç¼“å­˜

```bash
# 1. åˆ›å»ºè®¢å•(åœ¨ 5 åˆ†é’Ÿå†…)
curl -X POST http://localhost:3000/api/operators/unitel/orders \
  -H "Authorization: Bearer {token}" \
  -H "Content-Type: application/json" \
  -d '{
    "msisdn": "99887766",
    "orderType": "balance",
    "packageCode": "SD5000"
  }'

# 2. æ£€æŸ¥æ—¥å¿—
# âœ… åº”è¯¥çœ‹åˆ°: "ä½¿ç”¨ç¼“å­˜çš„èµ„è´¹åˆ—è¡¨: unitel:service_types:oABC123:99887766"
# âŒ ä¸åº”è¯¥çœ‹åˆ°: "ç¼“å­˜miss,æ­£åœ¨ä»ç¬¬ä¸‰æ–¹è·å–èµ„è´¹åˆ—è¡¨"
```

#### æµ‹è¯•3: éªŒè¯ä»·æ ¼é˜²ç¯¡æ”¹

```bash
# 1. å°è¯•ä¼ å…¥é”™è¯¯çš„ä»·æ ¼å­—æ®µ(DTO ä¼šå¿½ç•¥)
curl -X POST http://localhost:3000/api/operators/unitel/orders \
  -H "Authorization: Bearer {token}" \
  -H "Content-Type: application/json" \
  -d '{
    "msisdn": "99887766",
    "orderType": "balance",
    "packageCode": "SD5000",
    "amountMnt": 1,
    "amountCny": 0.01
  }'

# 2. æ£€æŸ¥è¿”å›çš„è®¢å•
{
  "orderNo": "UNI...",
  "amountMnt": 5000,  # âœ… åç«¯éªŒè¯çš„ä»·æ ¼,ä¸æ˜¯ 1
  "amountCny": 11.36  # âœ… åç«¯éªŒè¯çš„ä»·æ ¼,ä¸æ˜¯ 0.01
}
```

---

## ğŸ“Š ä»£ç æ–‡ä»¶å…³ç³»å›¾

```
å‰ç«¯è¯·æ±‚è·å–èµ„è´¹
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ unitel-service.controller.ts                â”‚
â”‚ - getServiceTypes(@CurrentUser openid, dto) â”‚
â”‚ - æå– openid + msisdn                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ unitel-api.service.ts                       â”‚
â”‚ - getCachedServiceTypes(msisdn, openid)     â”‚
â”‚ - ç¼“å­˜é”®: unitel:service_types:{openid}:{msisdn} â”‚
â”‚ - TTL: 5åˆ†é’Ÿ                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Redis                                       â”‚
â”‚ Key: unitel:service_types:oABC123:99887766  â”‚
â”‚ Value: { service: { cards: [...], data: [...] } } â”‚
â”‚ TTL: 300 ç§’                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å‰ç«¯åˆ›å»ºè®¢å•
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ unitel-order.controller.ts                  â”‚
â”‚ - createOrder(@CurrentUser openid, dto)     â”‚
â”‚ - dto åªåŒ…å«: msisdn, orderType, packageCodeâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ unitel-order.service.ts                     â”‚
â”‚ - createOrder(openid, dto)                  â”‚
â”‚ - è°ƒç”¨ findPackageByCode(...)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ unitel-api.service.ts                       â”‚
â”‚ - findPackageByCode(packageCode, msisdn, openid) â”‚
â”‚ - è°ƒç”¨ getCachedServiceTypes(msisdn, openid)â”‚
â”‚ - ä½¿ç”¨ç›¸åŒç¼“å­˜é”®!                           â”‚
â”‚ - ä»ç¼“å­˜ä¸­æŸ¥æ‰¾ packageCode å¯¹åº”çš„ä»·æ ¼       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Redis (å‘½ä¸­ç¼“å­˜!)                           â”‚
â”‚ Key: unitel:service_types:oABC123:99887766  â”‚
â”‚ è¿”å›å¥—é¤è¯¦æƒ…: { code: "SD5000", price: 5000 }â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ unitel-order.service.ts                     â”‚
â”‚ - ä½¿ç”¨ price=5000 åˆ›å»ºè®¢å•                  â”‚
â”‚ - ä¿å­˜åˆ°æ•°æ®åº“                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. ç¼“å­˜è¿‡æœŸåçš„è¡Œä¸º
- å¦‚æœç”¨æˆ·åœ¨ç¼“å­˜è¿‡æœŸååˆ›å»ºè®¢å•
- ç³»ç»Ÿä¼šé‡æ–°è°ƒç”¨ Unitel API è·å–æœ€æ–°èµ„è´¹
- **å¯èƒ½å‡ºç°ä»·æ ¼å˜åŠ¨** - è¿™æ˜¯æ­£ç¡®çš„è¡Œä¸º(ä¿è¯ä»·æ ¼å‡†ç¡®)

### 2. ä¸åŒç”¨æˆ·ä¹‹é—´çš„ç¼“å­˜éš”ç¦»
- æ¯ä¸ªç”¨æˆ·çš„ç¼“å­˜æ˜¯ç‹¬ç«‹çš„(åŒ…å« openid)
- ç”¨æˆ· A çš„ç¼“å­˜ä¸ä¼šå½±å“ç”¨æˆ· B

### 3. ç¼“å­˜å¤±æ•ˆåœºæ™¯
- Redis é‡å¯ â†’ ç¼“å­˜å…¨éƒ¨æ¸…ç©º â†’ é‡æ–°è°ƒç”¨ API
- æ‰‹åŠ¨åˆ é™¤ç¼“å­˜ â†’ é‡æ–°è°ƒç”¨ API
- TTL è¿‡æœŸ â†’ é‡æ–°è°ƒç”¨ API

### 4. CreateOrderDto ä¸æ¥æ”¶ä»·æ ¼å­—æ®µ
```typescript
// âœ… æ­£ç¡®çš„ DTO è®¾è®¡
export class CreateOrderDto {
  @IsString()
  msisdn: string;

  @IsEnum(OrderType)
  orderType: OrderType;

  @IsString()
  packageCode: string;

  // âŒ ä¸åŒ…å« amountMnt, amountCny
}
```

---

## ğŸ¯ æœ€ä½³å®è·µæ€»ç»“

### âœ… DO (æ¨èåšæ³•)

1. **å‰ç«¯åªä¼ ä¸šåŠ¡æ ‡è¯†** - ä¼  `packageCode`,ä¸ä¼  `price`
2. **åç«¯éªŒè¯æ‰€æœ‰ä»·æ ¼** - ä»å¯ä¿¡æº(ç¼“å­˜æˆ– API)è·å–
3. **ä½¿ç”¨ä¸€è‡´çš„ç¼“å­˜é”®** - ç¡®ä¿å‰ç«¯å’Œåˆ›å»ºè®¢å•ä½¿ç”¨ç›¸åŒç¼“å­˜
4. **åˆç†è®¾ç½® TTL** - å¹³è¡¡æ€§èƒ½å’Œå‡†ç¡®æ€§(å½“å‰ 5 åˆ†é’Ÿ)
5. **è®°å½•è¯¦ç»†æ—¥å¿—** - ä¾¿äºæ’æŸ¥ç¼“å­˜å‘½ä¸­æƒ…å†µ

### âŒ DON'T (é¿å…åšæ³•)

1. âŒ ä¸è¦åœ¨ DTO ä¸­æ¥æ”¶ä»·æ ¼å­—æ®µ
2. âŒ ä¸è¦ç›´æ¥ä½¿ç”¨å‰ç«¯ä¼ æ¥çš„ä»·æ ¼
3. âŒ ä¸è¦åœ¨ä¸åŒåœºæ™¯ä½¿ç”¨ä¸åŒçš„ç¼“å­˜é”®
4. âŒ ä¸è¦è®¾ç½®è¿‡é•¿çš„ TTL(å¯èƒ½å¯¼è‡´ä»·æ ¼è¿‡æ—¶)
5. âŒ ä¸è¦å¿½ç•¥ç¼“å­˜å¤±æ•ˆçš„å¤„ç†

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Unitel API æ¨¡å—è®¾è®¡](./UNITEL_API_MODULE.md)
- [è®¢å•æ¨¡å—æ€»ç»“](./unitel-order-module-summary.md)
- [æ¶æ„è®¾è®¡æ–‡æ¡£](./architecture-plan.md)

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0.0
**æœ€åæ›´æ–°**: 2025-10-24
**ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ
